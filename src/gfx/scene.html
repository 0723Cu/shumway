<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style>
    body {
      color: white;
      font: 12px Consolas, "Liberation Mono", Courier, monospace;
    }
    canvas {
      background-color: #1a2633;
    }
  </style>
</head>

<script> console.time("Load Shared Dependencies"); </script>
<script src="../../build/ts/base.js"></script>
<script src="../../build/ts/tools.js"></script>
<script> console.timeEnd("Load Shared Dependencies"); </script>
<script> console.time("Load GFX Dependencies"); </script>
<script src="../../build/ts/gfx-base.js"></script>
<script src="../../build/ts/gfx.js"></script>
<script> console.timeEnd("Load GFX Dependencies"); </script>
<script>
  var Rectangle = Shumway.GFX.Geometry.Rectangle;
  var Stage = Shumway.GFX.Stage;
  var Shape = Shumway.GFX.Shape;
  var CustomRenderable = Shumway.GFX.CustomRenderable;
  var Canvas2DStageRenderer = Shumway.GFX.Canvas2D.Canvas2DStageRenderer;
  var Easel = Shumway.GFX.Easel;
  var Backend = Shumway.GFX.Backend;
  var BlendMode = Shumway.GFX.BlendMode;
</script>
<body style="background-color: #333333;">
  <table>
    <tr>
      <td>
        A (1024 x 1024)
      </td>
    </tr>
    <tr>
      <td>
        <div id="container" style="width: 1024px; height: 512px"></div>
      </td>
    </tr>
    <tr>
      <td>
        <div id="aResults"></div>
      </td>
    </tr>
  </table>
  <br>
  <button onclick="test()">Do</button>

  <button onclick="garbage()">Garbage</button>
  <script>
    var container = document.getElementById("container");

    var easel = new Easel(container, Backend.Canvas2D)
    var stage = easel.stage;

    function tick() {
      stage.children.forEach(function (child) {
        child.x += child.dx;
        child.y += child.dy;
      })
      requestAnimationFrame(tick);
    }

    tick();

    function makeRectangle(w, h) {
      return new CustomRenderable(new Rectangle(0, 0, w, h), function (context) {
        context.fillStyle = "red";
        context.fillRect(0, 0, w, h);
      });
    }

    function test() {
      for (var i = 0; i < 100; i++) {
        var shape = new Shape(makeRectangle(64, 64));
        // shape.blendMode = BlendMode.Difference;
        shape.dx = Math.random() - 0.5;
        shape.dy = Math.random() - 0.5;
        stage.addChild(shape);
        shape.x = stage.w / 4;
        shape.y = stage.h / 4;
      }
    }

    function garbage() {
      setInterval(function () {
        for (var i = 0; i < 10000; i++) {
          new Array(1024);
        }
      });
    }
  </script>
</body>
</html>